% % Apunte de modulos basicos
%
\documentclass[a4paper,10pt]{article}
\usepackage[paper=a4paper, hmargin=1.5cm, bottom=1.5cm, top=3.5cm]{geometry}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[spanish]{babel}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{xspace}
\usepackage{xargs}
\usepackage{ifthen}
\usepackage{aed2-tad,aed2-symb,aed2-itef}
\usepackage{algorithmicx, algpseudocode, algorithm}
\usepackage[colorlinks=true, linkcolor=blue]{hyperref}


\hypersetup{%
 % Para que el PDF se abra a página completa.
 pdfstartview= {FitH \hypercalcbp{\paperheight-\topmargin-1in-\headheight}},
 pdfauthor={Cátedra de Algoritmos y Estructuras de Datos II - DC - UBA},
 pdfkeywords={Módulos básicos},
 pdftitle={Módulos básicos de diseño},
 pdfsubject={Módulos básicos de diseño}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PARAMETROS A SER MODIFICADOS
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%cuatrimestre de acuerdo a la opcion
\newcommand{\Cuatrimestre}{$2^\mathrm{do}$ cuatrimestre de 2021}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% OTRAS OPCIONES QUE NO HAY QUE MODIFICAR
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%opening
\title{Resumen SQL}
\author{Programacion Frontend}
\date{Julio 2023}

% Acomodo fancyhdr.
\pagestyle{fancy}
\thispagestyle{fancy}
\lhead{Resumen SQL}
\rhead{Julio 2023}
\cfoot{\thepage /\pageref{LastPage}}
\renewcommand{\footrulewidth}{0.4pt}
\setlength{\headheight}{13pt}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% COMANDOS QUE ALGUN DIA PUEDAN FORMAR UN PAQUETE.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\moduloNombre}[1]{\textbf{#1}}

\let\NombreFuncion=\textsc
\let\TipoVariable=\texttt
\let\ModificadorArgumento=\textbf
\newcommand{\res}{$res$\xspace}
\newcommand{\tab}{\hspace*{7mm}}

\newcommandx{\TipoFuncion}[3]{%
  \NombreFuncion{#1}(#2) \ifx#3\empty\else $\to$ \res\,: \TipoVariable{#3}\fi%
}
\newcommand{\In}[2]{\ModificadorArgumento{in} \ensuremath{#1}\,: \TipoVariable{#2}\xspace}
\newcommand{\Out}[2]{\ModificadorArgumento{out} \ensuremath{#1}\,: \TipoVariable{#2}\xspace}
\newcommand{\Inout}[2]{\ModificadorArgumento{in/out} \ensuremath{#1}\,: \TipoVariable{#2}\xspace}
\newcommand{\Aplicar}[2]{\NombreFuncion{#1}(#2)}

\newlength{\IntFuncionLengthA}
\newlength{\IntFuncionLengthB}
\newlength{\IntFuncionLengthC}
%InterfazFuncion(nombre, argumentos, valor retorno, precondicion, postcondicion, complejidad, descripcion, aliasing)
\newcommandx{\InterfazFuncion}[9][4=true,6,7,8,9]{%
  \hangindent=\parindent
  \TipoFuncion{#1}{#2}{#3}\\%
  \textbf{Pre} $\equiv$ \{#4\}\\%
  \textbf{Post} $\equiv$ \{#5\}%
  \ifx#6\empty\else\\\textbf{Complejidad:} #6\fi%
  \ifx#7\empty\else\\\textbf{Descripción:} #7\fi%
  \ifx#8\empty\else\\\textbf{Aliasing:} #8\fi%
  \ifx#9\empty\else\\\textbf{Requiere:} #9\fi%
}

\newenvironment{Interfaz}{%
  \parskip=2ex%
  \noindent\textbf{\Large Interfaz}%
  \par%
}{}

\newenvironment{Representacion}{%
  \vspace*{2ex}%
  \noindent\textbf{\Large Representación}%
  \vspace*{2ex}%
}{}

\newenvironment{Algoritmos}{%
  \vspace*{2ex}%
  \noindent\textbf{\Large Algoritmos}%
  \vspace*{2ex}%
}{}


\newcommand{\Titulo}[1]{
  \vspace*{1ex}\par\noindent\textbf{\large #1}\par
}

\newenvironmentx{Estructura}[2][2={estr}]{%
  \par\vspace*{2ex}%
  \TipoVariable{#1} \textbf{se representa con} \TipoVariable{#2}%
  \par\vspace*{1ex}%
}{%
  \par\vspace*{2ex}%
}%

\newboolean{EstructuraHayItems}
\newlength{\lenTupla}
\newenvironmentx{Tupla}[1][1={estr}]{%
    \settowidth{\lenTupla}{\hspace*{3mm}donde \TipoVariable{#1} es \TipoVariable{tupla}$($}%
    \addtolength{\lenTupla}{\parindent}%
    \hspace*{3mm}donde \TipoVariable{#1} es \TipoVariable{tupla}$($%
    \begin{minipage}[t]{\linewidth-\lenTupla}%
    \setboolean{EstructuraHayItems}{false}%
}{%
    $)$%
    \end{minipage}
}

\newcommandx{\tupItem}[3][1={\ }]{%
    %\hspace*{3mm}%
    \ifthenelse{\boolean{EstructuraHayItems}}{%
        ,#1%
    }{}%
    \emph{#2}: \TipoVariable{#3}%
    \setboolean{EstructuraHayItems}{true}%
}

\newcommandx{\RepFc}[3][1={estr},2={e}]{%
  \tadOperacion{Rep}{#1}{bool}{}%
  \tadAxioma{Rep($#2$)}{#3}%
}%

\newcommandx{\Rep}[3][1={estr},2={e}]{%
  \tadOperacion{Rep}{#1}{bool}{}%
  \tadAxioma{Rep($#2$)}{true \ssi #3}%
}%

\newcommandx{\Abs}[5][1={estr},3={e}]{%
  \tadOperacion{Abs}{#1/#3}{#2}{Rep($#3$)}%
  \settominwidth{\hangindent}{Abs($#3$) \igobs #4: #2 $\mid$ }%
  \addtolength{\hangindent}{\parindent}%
  Abs($#3$) \igobs #4: #2 $\mid$ #5%
}%

\newcommandx{\AbsFc}[4][1={estr},3={e}]{%
  \tadOperacion{Abs}{#1/#3}{#2}{Rep($#3$)}%
  \tadAxioma{Abs($#3$)}{#4}%
}%


\newcommand{\DRef}{\ensuremath{\rightarrow}}

\begin{document}

%pagina de titulo
\thispagestyle{empty}
\maketitle
\tableofcontents

\newpage

\section{Clausulas}

\subsection{Clausula SELECT}

\TipoVariable{SELECT * FROM users} se utiliza para seleccionar todo desde la tabla \TipoVariable{users}. Ahora, vamos a insertar en la tabla users los campos (columnas) name, surname y age de la siguiente manera:
\newline
\newline
\TipoVariable{INSERT INTO users (name,surname,age)  VALUES ('Ezequiel', 'Rueda Sanchez', '24')}
\newline
\newline
Observamos que al ejecutar esta instrucción obtenemos:
\newline
\newline
\TipoVariable{'Result: query executed successfully. Took 5ms'}.
\newline
\newline
Esto es así porque cualquier operación (en este caso \TipoVariable{INSERT}) que realicemos con SQL la toma como una consulta.
\newline
\newline
Ahora si ejecutamos \TipoVariable{SELECT * FROM users} nos devuelve la siguiente tabla:
\newline
\newline
\begin{tabular}{|c|c|c|}
	\hline
	Name     &  Surname         &   Age     \\ \hline
	Ezequiel &  Rueda Sanchez   &   24      \\ \hline
\end{tabular}
\newline
\newline
\newline
También puedo agregar varios usuarios al mismo tiempo de la siguiente manera:
\newline
\newline
\TipoVariable{INSERT into users (name, surname,  age) VALUES ('Pedro', 'Rodriguez', 26), ('Carlos', 'Sanchez', 18), ('Francisco', 'Alvarez', 52)}
\newline
\newline
Ahora, ejecuto \TipoVariable{SELECT * FROM users} para ver el nuevo estado de la tabla.
\newline
\newline
Al ejecutar \TipoVariable{SELECT age FROM users}, filtramos la tabla para que solo nos devuelva el campo \TipoVariable{age} con sus respectivos registros.
\newline
\newline
Ahora insertamos el registro \TipoVariable{('Francisco', 'Alvarez', 52)} y tenemos dos registros iguales. 
\newline
\newline
¿Como los podemos diferenciar?
\newline
\newline
No hay manera de diferenciarlos. Para eso, utilizamos los \textbf{identificadores}. Tenemos los $primary$ $keys$ y los $foreign$ $keys$.
\newline
\newline
Para ello, vamos a modificar la tabla colocando un nuevo campo llamado \TipoVariable{id\_user} de tipo integer. 
\newline
\newline
Ahora, al mostrar la tabla (\TipoVariable{SELECT * FROM users}), observamos que todos los registros tienen el campo \TipoVariable{id\_user} con \TipoVariable{NULL}.
\newline
\newline
Entonces, vamos a borrar todos los registros ejecutando \TipoVariable{DELETE FROM users}.
\newline
\newline
Ahora, vuelvo a modificar la tabla y puedo aplicar la opción \TipoVariable{AI} (Auto Increment) para que cada registro sea unico y automáticamente se me aplica la opción \TipoVariable{PK} (Primary Key) porque nos garantiza una integridad referencial, es decir, podemos hacer referencias a registros sin tener valores duplicados.
\newline
\newline
Por lo tanto, ahora a medida que vayamos insertando registros el id se va a auto incrementar en uno para que no haya ninguna posibilidad de que dos registros sean exactamente iguales. Luego, armamos una tabla nueva que llamamos \TipoVariable{turnos\_medicos} donde insertamos los campos \TipoVariable{id\_turno}, \TipoVariable{profesional}, \TipoVariable{id\_user} (F(oreign) K(ey) o clave foranea), \TipoVariable{motivo} y \TipoVariable{horario}.
\newline
\newline
Decimos que una clave es foránea en una tabla cuando hace referencia a una clave primaria (PK) de otra tabla y se le debe colocar el mismo nombre tanto en la tabla como en la tabla donde es PK.
\newline
\newline
De ahora en adelante, vamos a trabajar con la base de datos de \textbf{Northwind}.
\newline
\newline
\newline
Supongamos que queremos cambiar el nombre del campo \TipoVariable{LastName}. No lo puedo hacer desde la tabla pero puedo modificarlo localmente con \TipoVariable{SELECT LastName AS surname FROM Employees}.
\newline
\newline
De ahora en adelante, esta renombrado localmente como \TipoVariable{surname} aunque en la tabla el campo sigue siendo \TipoVariable{LastName}.
\newline
\newline
También podemos renombrarlo varios campos mediante comas. Por ejemplo: 
\newline
\newline
\TipoVariable{SELECT LastName AS surname, FirstName AS name  FROM Employees}
\newline
\newline
Por lo tanto, utilizamos la cláusula \TipoVariable{AS} para que una tabla/campo sea mas declarativo o descriptivo.
\newline
\newline
Ahora, volvemos a ver toda la de products ejecutando \TipoVariable{SELECT * FROM Products}.
\newline
\newline
Luego, quiero ordenar la tabla pero según el precio (campo \TipoVariable{PRICE}) de forma creciente. Sabemos que por defecto, los productos están ordenados según el numero de \TipoVariable{ID} porque son autoincrementables. Para ello ejecutamos las siguientes lineas:
\newline
\newline
\TipoVariable{SELECT * FROM Products ORDER BY price}
\newline
\newline
También podríamos ejecutar \TipoVariable{SELECT * FROM Products ORDER BY price ASC}. Y  obtenemos el mismo resultado.
\newline
\newline
Si queremos ordenar los precios de forma decreciente, ejecutamos las siguientes lineas:
\newline
\newline
\TipoVariable{SELECT * FROM Products ORDER BY price DESC}
\newline
\newline
\TipoVariable{ASC} y \TipoVariable{DESC} funcionan tanto para los precios como para el campo text \TipoVariable{ProductName}. En este caso, por defecto o \TipoVariable{ASC} ordena alfabeticamente de menor a mayor (de la A a la Z) y \TipoVariable{DESC} ordena alfabeticamente de mayor a menor (de la Z a la A).
\newline
\newline
Notemos que la tabla ordena de acuerdo a la siguiente jerarquía:
\newline
\newline
\TipoVariable{NULL $>$ NUMEROS $>$ CARACTERES ESPECIALES $>$ CARACTERES COMUNES}
\newline
\newline
Por lo tanto, si agregamos un registro \TipoVariable{NULL} en la tabla de \TipoVariable{Products} y ejecutamos:
\newline
\newline
\TipoVariable{SELECT * FROM Products ORDER BY ProductName ASC}
\newline
\newline
El registro \TipoVariable{NULL} se convierte en el primero de la tabla.
\newline
\newline
Ahora, si quiero colocar todos los registros NULL al final de la tabla ejecuto:
\newline
\newline
\TipoVariable{SELECT * FROM Products ORDER BY ProductName ASC NULLS LAST}
\newline
\newline
\TipoVariable{ASC} esta ordenando de forma creciente, es decir, los \TipoVariable{NULLs} van al principio pero al ejecutar \TipoVariable{NULLs LAST} estoy indicando que los voy a colocar al final de la tabla.
\newline
\newline
Ahora, si quiero colocar todos los registros NULL al principio de la tabla cuando estoy ordenando de forma descendente ejecuto:
\newline
\newline
\TipoVariable{SELECT * FROM Products ORDER BY ProductName DESC NULLS FIRST}
\newline
\newline
\TipoVariable{ASC} esta ordenando de forma creciente, es decir, los \TipoVariable{NULLs} van al principio pero al ejecutar \TipoVariable{NULLs LAST} estoy indicando que los voy a colocar al final de la tabla.
\newline
\newline
Ahora, si queremos ordenar la tabla de una manera \TipoVariable{RANDOM} ejecutamos:
\newline
\newline
\TipoVariable{SELECT * FROM Products ORDER BY RANDOM()}
\newline
\newline
Ahora, si ejecutamos:
\newline
\newline
\TipoVariable{SELECT * FROM Products ORDER BY ProductName, SupplierID DESC}
\newline
\newline
Se ordena primero respecto a \TipoVariable{ProductName} y en caso de que los registros sean iguales, en base a \TipoVariable{SupplierID}. Ahora, si queremos eliminar todos los repetidos por ejemplo de \TipoVariable{ProductName} ejecutamos:
\newline
\newline
\TipoVariable{SELECT DISTINCT ProductName FROM Products}
\newline
\newline
Con esto eliminamos todas las repeticiones de \TipoVariable{NULL} y solo nos quedamos con una (con la primera aparición).
\newline
\newline
Ademas, podemos ordenar los registros del campo ProductName ejecutando lo siguiente:
\newline
\newline
\TipoVariable{SELECT DISTINCT ProductName FROM Products ORDER BY ProductName DESC}
\newline
\newline
Por lo tanto, primero solo se deja la primera aparición de cada producto y luego se ordena los mismos de manera decreciente.
\newpage

\subsection{Clausula WHERE}

Supongamos que queremos ver cual es el nombre asociado al \TipoVariable{productId} numero 14. Entonces, comenzamos ejecutando:
\newline
\newline
\TipoVariable{SELECT ProductName FROM Products} obteniendo el listado de productos.
\newline
\newline
Ahora si queremos ver cual es el nombre asociado al productId numero 14 ejecutamos:
\newline
\newline
\TipoVariable{SELECT ProductName FROM Products WHERE ProductID = 14}
\newline
\newline
Si queremos obtener toda la información del registro con \TipoVariable{ProductID = 14} ejecutamos:
\newline
\newline
\TipoVariable{SELECT * FROM Products WHERE ProductID = 14}
\newline
\newline
Ahora, supongamos que solo tenemos un presupuesto de 40USD y quiero ver que productos puedo comprar. Para ello, ejecuto lo siguiente:
\newline
\newline
\TipoVariable{SELECT * FROM Products WHERE Price $<$ 40}
\newline
\newline
Ahora, supongamos que queremos eliminar el registro \TipoVariable{NULL} con \TipoVariable{ProductID = 80}. Para ello, ejecutamos lo siguiente:
\newline
\newline
\TipoVariable{DELETE FROM Products WHERE ProductID = 80}
\newline
\newline
Observemos que no es necesario escribir \TipoVariable{*} luego del \TipoVariable{DELETE}.

\subsection{Clausula UPDATE}

Supongamos que queremos el precio del producto \TipoVariable{Chais} (\TipoVariable{ProductID = 1}) que es de 18USD por 20USD. Para ello, ejecutamos:
\newline
\newline
\TipoVariable{UPDATE Products SET Price = 20 WHERE ProductId = 1}
\newline
\newline
Luego, ejecutamos \TipoVariable{SELECT * FROM Products} para ver el nuevo estado de la tabla.
\newline
\newline
Ahora, si queremos modificar el valor de mas de un campo nos alcanza con enumerar el campo seguido de una coma (,) y listo.
\newline
\newline
Por ejemplo, \TipoVariable{UPDATE Products SET Price = 20, ProductName = 'Chais modificado' WHERE ProductId = 1}
\newline
\newline
Para modificar el campo \TipoVariable{Price} y \TipoVariable{ProductName}.   
\newpage

\subsection{Clausula AND}

Ahora, vamos a la tabla de clientes (Customers). Entonces, si queremos consultar por aquellos que se encuentran entre el \TipoVariable{CustomerId 50} inclusive y el \TipoVariable{CustomerId 55} exclusive, utilizamos la clausula \TipoVariable{AND} de la siguiente manera:
\newline
\newline
\TipoVariable{SELECT * FROM Customers WHERE CustomerId $>$=  50 AND CustomerId $<$ 55}

\subsection{Clausula OR}

Ahora, vamos a la tabla de empleados (Employees) aplicando \TipoVariable{SELECT * FROM Employees}.
\newline
\newline
Luego, queremos ver los datos de las empleadas Nancy o Anne. Para ello, aplicamos \TipoVariable{OR} que funciona como union, es decir:
\newline
\newline
\TipoVariable{SELECT * FROM Employees WHERE FirstName = $"$Nancy$"$ OR FirstName = $"$Anne$"$}

\subsection{Clausula NOT}

Volviendo a la tabla de productos (Products), queremos acceder a todos aquellos productos donde su precio no es mayor a 40. Para ello, utilizamos la cláusula \TipoVariable{NOT} de la siguiente manera:
\newline
\newline
\TipoVariable{SELECT * FROM Products WHERE NOT Price $>$ 40}  

\subsection{Clausula LIMIT}

Ahora, volvemos a la tabla Customers y queremos obtener los primeros 5 clientes a partir del CustomerID 50 y que el país del cliente no sea Alemania (Germany). Entonces, usamos la cláusula LIMIT para realizar esta solicitud de la siguiente manera:
\newline
\newline
\TipoVariable{SELECT * FROM Customers WHERE CustomerID $>=$ 50 AND NOT Country = "Germany" LIMIT 5}
\newline
\newline
Finalmente, podemos ordenar esta solicitud aplicando \TipoVariable{ORDER BY} de la siguiente manera:
\newline
\newline
\TipoVariable{SELECT * FROM Customers WHERE CustomerID >= 50 AND NOT Country = "Germany" ORDER BY RANDOM() LIMIT 5}
\newpage

\subsection{Cláusula GROUP BY y HAVING}

La clausula \textbf{GROUP BY} se utiliza para agrupar uno o varios registros según uno o varios valores de las columnas (campos).
\newline
\newline
Supongamos que queremos calcular el precio promedio de los productos de acuerdo a los proveedores y ordenarlos de manera decreciente. Para ello ejecutamos lo siguiente:
\newline
\newline
\TipoVariable{SELECT SupplierID, ROUND(AVG(Price)) as promedio from Products GROUP BY SupplierID ORDER BY promedio DESC}
\newline
\newline
Ahora queremos seleccionar el nombre del producto (\TipoVariable{ProductName}) también, ejecutamos lo siguiente:
\newline
\newline
\TipoVariable{SELECT ProductName, SupplierID, ROUND(AVG(Price)) as promedio from Products GROUP BY SupplierID ORDER BY promedio DESC}
\newline
\newline
Observemos que el \TipoVariable{ProductName} que retorna es aquel que figura primero con el \TipoVariable{SupplierID} correspondiente.
\newline
\newline
La clausula \TipoVariable{HAVING} nos sirve para realizar filtrado de grupos. A diferencia de la clase \TipoVariable{WHERE} que nos sirve para realizar filtrado de registros.
\newline
\newline
Entonces, si queremos calcular el promedio de los productos de acuerdo a su \TipoVariable{SupplierID}, agruparlos y mostrar aquellos en los que el promedio es mayor a 40 ejecutamos lo siguiente:
\newline
\newline
\TipoVariable{SELECT SupplierID, ROUND(AVG(Price)) as promedio from Products GROUP BY SupplierID HAVING promedio $>$ 40}
\newline
\newline
Observemos que aca no podemos usar la clausula \TipoVariable{WHERE} porque queremos mostrar el promedio que es resultante de una función de agregación \TipoVariable{ROUND(AVG(Price))} y no de un registro.
\newpage

\section{Operadores}

\subsection{Operador !=}

Es un operador de comparación.
 
\subsection{Operador BETWEEN}

El operador \textbf{Between} es un operador de comparación que se utiliza para seleccionar valores en un rango especifico.
\newline
\newline
Supongamos ahora que queremos seleccionar todos aquellos productos donde su precio esta en el rango de 20 a 40 USD.
\newline
\newline
Para ello ejecutamos la siguiente linea:
\newline
\newline
\TipoVariable{SELECT * FROM Products WHERE Price BETWEEN 20 AND 40}
\newline
\newline
También podemos combinarlo con los operadores \TipoVariable{AND} y \TipoVariable{OR} como por ejemplo:
\newline
\newline
\TipoVariable{SELECT * FROM Products WHERE Price BETWEEN 20 AND 40 AND CategoryID = 6}
\newline
\newline
El operador BETWEEN también nos sirve para utilizarlo con fechas. Por ejemplo, si queremos filtrar a aquellos empleados que nacieron entre el año 1960 y 1970 ejecutamos lo siguiente: 
\newline
\newline
\TipoVariable{SELECT * FROM Employees WHERE BirthDate BETWEEN "1960-0-1" AND "1970-0-1"}
\newline
\newline
Observamos también que los limites son inclusivos y que siempre se pasan del limite menor al limite mayor.

\subsection{Operador LIKE}

El operador \textbf{Like} es un operador de comparación utilizado para buscar y filtrar registros en función de ciertos patrones de cadena de texto.
\newline
\newline
Por ejemplo, si queremos filtrar todos los empleados con apellido \TipoVariable{Fuller} podemos ejecutar lo siguiente:
\newline
\newline
\TipoVariable{SELECT * FROM Employees WHERE LastName LIKE "Fuller"}
\newline
\newline
Esencialmente, utilizar \TipoVariable{=} y \TipoVariable{LIKE} es lo mismo pero \TipoVariable{LIKE} tiene ciertos caracteres especiales que nos permiten realizar lo siguiente:
\newline
\newline
\TipoVariable{SELECT * FROM Employees WHERE LastName LIKE "F\%"}. En este caso, estamos realizando una búsqueda de aquellos apellidos que comienzan con \TipoVariable{F} pero no me importa como siguen.
\newline
\newline
\TipoVariable{SELECT * FROM Employees WHERE LastName LIKE "\%r"}. En este caso, estamos realizando una búsqueda de aquellos apellidos que terminan con r pero no me importa como empiezan.
\newline
\newline
\TipoVariable{SELECT * FROM Employees WHERE LastName LIKE "\%a\%"}. En este caso, estamos realizando una búsqueda de aquellos apellidos que tienen la letra a en alguna parte del \TipoVariable{LastName}.
\newline
\newline
\TipoVariable{SELECT * FROM Employees WHERE LastName LIKE \#Full\_\_"}. En este caso, estamos realizando una búsqueda de aquellos apellidos que comienzan con \TipoVariable{Full} y tienen dos caracteres mas pero no me interesan cuales son. Esa es la función del caracteres especial.
\newpage

\subsection{Operador IS NULL y Operador IS NOT NULL}

Supongamos ahora que queremos obtener unicamente aquellos productos que no son nulos y ordenarlos ascendentemente por \TipoVariable{ProductName}. Para ello, ejecutamos lo siguiente:
\newline
\newline
\TipoVariable{SELECT * FROM Products WHERE ProductName IS NOT NULL ORDER BY ProductName ASC}
\newline
\newline
Si queremos obtener unicamente aquellos productos que son nulos y ordenarlos descendentemente por ProductName, ejecutamos lo siguiente:
\newline
\newline
\TipoVariable{SELECT * FROM Products WHERE ProductName IS NOT NULL ORDER BY ProductName DESC}

\subsection{Operador IN}

Introducción a las subconsultas.
\newline
\newline
Supongamos que queremos seleccionar los productos de los proveedores 3,4,5 y 6. Una opción es ejecutar:
\newline
\newline
\TipoVariable{SELECT * FROM Products WHERE SupplierID = 3 OR SupplierID = 4 OR SupplierID = 5 OR SupplierID = 6}
\newline
\newline
La opción mas recomendada es usar el operador \TipoVariable{IN} (funciona como un pertenece en conjuntos), es decir, podemos ejecutar:
\newline
\newline
\TipoVariable{SELECT * FROM Products WHERE SupplierID IN (3,4,5,6)}
\newpage

\section{Funciones de agregación}

Las \textbf{funciones de agregación} nos permiten agregar datos, resumirlos e incluso trabajar con estadísticas sobre los datos.
\newline
\newline
Supongamos que quiero contar la cantidad de nombres que hay en la tabla de empleados y por ende, la cantidad de empleados que tengo. Entonces, ejecuto:
\newline
\newline
\TipoVariable{SELECT count(firstName) FROM Employees}
\newline
\newline
A esto lo permite la función \TipoVariable{count()} que cuenta la cantidad de registros que tiene asociado un campo.
\newline
\newline
Por defecto, me devuelve el resultado con el nombre del campo \TipoVariable{count(firstName)} pero si lo quiero renombrado utilizo \TipoVariable{AS}, es decir:
\newline
\newline
\TipoVariable{SELECT count(firstName) AS Cantidad\_de\_nombres FROM Employees}
\newline
\newline
Ahora, si quiero sumar todos los precios de la tabla Products utilizo la función SUM(), es decir:
\newline
\newline
\TipoVariable{SELECT SUM(Price) AS Suma\_precios FROM Products}
\newline
\newline
Si queremos calcular el promedio de los precios, utilizo la función \TipoVariable{AVG()} de la siguiente manera:
\newline
\newline
\TipoVariable{SELECT AVG(Price) AS promedio FROM Products}
\newline
\newline
Si queremos redondear a entero el promedio de los precios, utilizo la función \TipoVariable{ROUND()} de la siguiente manera:
\newline
\newline
\TipoVariable{SELECT ROUND(AVG(Price)) AS promedio\_redondeado FROM Products}
\newline
\newline
Ahora, si quiero redondear por dos decimales ejecuto:
\newline
\newline
\TipoVariable{SELECT ROUND(AVG(Price), 2) AS promedio\_redondeado\_dos\_unidades FROM Products}
\newline
\newline
Ahora, si quiero calcular el producto de menor precio utilizo \textbf{MIN}:
\newline
\newline
\TipoVariable{SELECT MIN(Price) FROM Products}
\newline
\newline
Ademas, si quiero mostar el nombre del producto de menor precio tambien ejecuto:
\newline
\newline
\TipoVariable{SELECT ProductName, MIN(Price) FROM Products}
\newline
\newline
Ahora, si quiero calcular el producto de mayor precio utilizo \textbf{MAX}:
\newline
\newline
\TipoVariable{SELECT MAX(Price) FROM Products}
\newpage

\section{Subconsultas}

Ahora, el objetivo va a ser relacionar dos tablas. En este caso, vamos a querer relacionar la tabla de Productos (\TipoVariable{Products}) con la tabla de detalles de la orden (\TipoVariable{OrderDetails}) porque queremos obtener la cantidad de productos que se vendieron por cada producto y saber cual es el que genera mas ganancias. Con la tabla \TipoVariable{OrderDetails} podemos calcular cual es producto (de acuerdo a su \TipoVariable{ProductID}) que se vende mas veces pero eso no significa necesariamente que sea el que genera mas ganancia. Por ejemplo, puede haber un producto (supongamos \TipoVariable{ProductID = 2}) que se haya vendido 20 veces y su precio sea de 1USD y puede haber otro producto (supongamos \TipoVariable{ProductID = 5}) que se haya vendido solo 1 vez pero su precio sea de 200USD y observamos que es mayor la ganancia del producto con \TipoVariable{ProductID = 5} que la del producto con \TipoVariable{ProductID = 2}.
\newline
\newline
Entonces, para resolver esto vamos a usar las \textbf{Subconsultas} porque en la tabla \TipoVariable{OrderDetails} tengo el \TipoVariable{ProductID} con la cantidad \TipoVariable{Quantity} de cada producto vendido. Y en la tabla \TipoVariable{Products} tengo el precio (Price) y el \TipoVariable{ProductID} de cada producto para poder realizar precio con cantidad de ventas de cada producto.
\newline
\newline
\textbf{Ejemplo}
\newline
\newline
Comenzamos consultando los campos \TipoVariable{ProductID} y \TipoVariable{Quantity} de la tabla \TipoVariable{OrderDetails} ejecutando lo siguiente:
\newline
\newline
\TipoVariable{SELECT ProductID, Quantity FROM OrderDetails}
\newline
\newline
Ahora, supongamos que quiero ver el nombre del producto pero este campo no lo tengo en la tabla \TipoVariable{OrderDetails} sino en la tabla \TipoVariable{Products}. Y lo puedo acceder a través de su \TipoVariable{ProductID} que se encuentra en ambas tablas.
\newline
\newline
Entonces, para realizar esto ejecutamos lo siguiente:
\newline
\newline
\TipoVariable{SELECT ProductID, Quantity, (SELECT ProductName from Products WHERE OrderDetails.ProductID = ProductID) as nombre\_producto FROM OrderDetails}
\newline
\newline
Por lo tanto, devolvemos de la tabla \TipoVariable{OrderDetails} los campos \TipoVariable{ProductID}, \TipoVariable{Quantity} y el campo resultante de la subconsulta que renombrados como \TipoVariable{nombre\_producto}.
\newline
\newline
El campo \TipoVariable{nombre\_producto} es el resultante de la subconsulta:
\newline
\newline
\TipoVariable{SELECT ProductName from Products WHERE OrderDetails.ProductID = ProductID}
\newline
\newline
En este caso, por cada \TipoVariable{ProductID} de la tabla \TipoVariable{OrderDetails}, busca en la tabla \TipoVariable{Products} el \TipoVariable{ProductID} que coincida con el \TipoVariable{ProductID} de la tabla \TipoVariable{OrderDetails} y retorna el \TipoVariable{ProductName} que se encuentra en la tabla \TipoVariable{Products}.
\newline
\newline
Ahora, queremos ver cual es el producto que mas recaudo. Para ello, ejecutamos lo siguiente:
\newline
\newline
\TipoVariable{SELECT ProductID, SUM(Quantity) as total\_vendido,}
\newline
\TipoVariable{(SELECT Price from Products WHERE OrderDetails.ProductID = ProductID) as Price,}
\newline
\TipoVariable{(SELECT ProductName from Products WHERE OrderDetails.ProductID = ProductID) as Name,}
\newline
\TipoVariable{ROUND(SUM(Quantity)) * (SELECT Price from Products WHERE OrderDetails.ProductID = ProductID) as Total\_recaudado}
\newline
\TipoVariable{FROM OrderDetails}
\newline
\TipoVariable{GROUP BY ProductID}
\newline
\TipoVariable{ORDER BY Total\_recaudado DESC}
\newpage
Ahora, si queremos filtrar aquellos productos donde sus precios sean mayores a 40USD y que no se muestre el campo \TipoVariable{Price}, ejecutamos lo siguiente:
\newline
\newline
\TipoVariable{SELECT ProductID, SUM(Quantity) as total\_vendido,}
\newline
\TipoVariable{(SELECT ProductName from Products WHERE OrderDetails.ProductID = ProductID) as Name,}
\newline
\TipoVariable{ROUND(SUM(Quantity)) * (SELECT Price from Products WHERE OrderDetails.ProductID = ProductID) as Total\_recaudado}
\newline
\TipoVariable{FROM OrderDetails}
\newline
\TipoVariable{WHERE (SELECT Price from Products WHERE OrderDetails.ProductID = ProductID) $>$ 40}
\newline
\TipoVariable{GROUP BY ProductID}
\newline
\TipoVariable{ORDER BY Total\_recaudado DESC}
\newline
\newline
Ahora, si queremos realizar la misma consulta pero también queremos mostrar el campo \TipoVariable{Price}, ejecutamos lo siguiente:
\newline
\newline
\TipoVariable{SELECT ProductID, SUM(Quantity) as total\_vendido,}
\newline
\TipoVariable{(SELECT Price from Products WHERE OrderDetails.ProductID = ProductID) as Price,}
\newline
\TipoVariable{(SELECT ProductName from Products WHERE OrderDetails.ProductID = ProductID) as Name,}
\newline
\TipoVariable{ROUND(SUM(Quantity)) * (SELECT Price from Products WHERE OrderDetails.ProductID = ProductID) as Total\_recaudado}
\newline
\TipoVariable{FROM OrderDetails}
\newline
\TipoVariable{WHERE Price > 40}
\newline
\TipoVariable{GROUP BY ProductID}
\newline
\TipoVariable{ORDER BY Total\_recaudado DESC}
\newline
\newline
Ahora, si quiero obtener solo el campo \TipoVariable{Price} de esta subconsulta, ejecuto lo siguiente:
\newline
\newline
\TipoVariable{SELECT Price FROM (}
\newline
\TipoVariable{SELECT ProductID, SUM(Quantity) as total\_vendido,}
\newline
\TipoVariable{(SELECT Price from Products WHERE OrderDetails.ProductID = ProductID) as Price,}
\newline
\TipoVariable{(SELECT ProductName from Products WHERE OrderDetails.ProductID = ProductID) as Name,}
\newline
\TipoVariable{ROUND(SUM(Quantity)) * (SELECT Price from Products WHERE OrderDetails.ProductID = ProductID) as Total\_recaudado}
\newline
\TipoVariable{FROM OrderDetails}
\newline
\TipoVariable{WHERE Price $>$ 40}
\newline
\TipoVariable{GROUP BY ProductID}
\newline
\TipoVariable{ORDER BY Total\_recaudado DESC)}
\newline
\newline
\textbf{Ejercicio 2}
\newline
\newline
Ahora, supongamos que queremos ver a aquellos empleados que lograron vender mas cantidad de unidades que el promedio. Entonces, comenzamos viendo el nombre (\TipoVariable{FirstName}) y apellido (\TipoVariable{LastName}) de los empleados (\TipoVariable{Employees}) ejecutando: 
\newline
\newline
\TipoVariable{SELECT FirstName, LastName FROM Employees}
\newline
\newline
Ahora, vamos a solicitar la cantidad vendida de cada uno de los empleados con la siguiente subconsulta: 
\newline
\newline
\TipoVariable{SELECT FirstName, LastName, (}
\newline
\TipoVariable{SELECT SUM(od.Quantity) FROM [Orders]  o, [OrderDetails] od}
\newline
\TipoVariable{WHERE o.EmployeeID = e.EmployeeID AND o.orderID = od.orderID}
\newline
\TipoVariable{) as Unidades\_totales}
\newline
\TipoVariable{FROM [Employees] e}
\newpage
Ahora, como queremos seleccionar a aquellos empleados tales que las \TipoVariable{Unidades\_totales} sean mayor al promedio podriamos intentar ejecutar \TipoVariable{WHERE Unidades\_totales $>$  AVG(Unidades\_totales)} pero esto no se puede. Entonces, creamos una subconsulta virtual que vuelva a pedir la cantidad de \TipoVariable{Unidades\_totales}, calculamos el promedio y comparamos con \TipoVariable{Unidades\_totales} de la siguiente manera:
\newline
\newline
\TipoVariable{SELECT FirstName, LastName, (}
\newline
\TipoVariable{SELECT SUM(od.Quantity) FROM [Orders]  o, [OrderDetails] od}
\newline
\TipoVariable{WHERE o.EmployeeID = e.EmployeeID AND o.orderID = od.orderID}
\newline
\TipoVariable{) as Unidades\_totales}
\newline
\TipoVariable{FROM [Employees] e}
\newline
\TipoVariable{WHERE Unidades\_totales > (SELECT AVG(Unidades\_totales) FROM (SELECT}
\newline
\TipoVariable{(SELECT SUM(od.Quantity) FROM [Orders]  o, [OrderDetails] od}
\newline
\TipoVariable{WHERE o.EmployeeID = e2.EmployeeID AND o.orderID = od.orderID}
\newline
\TipoVariable{) as Unidades\_totales}
\newline
\TipoVariable{FROM [Employees] e2}
\newline
\TipoVariable{GROUP BY e2.EmployeeID}
\newline
\TipoVariable{)}
\newline
\TipoVariable{) }





\end{document}
